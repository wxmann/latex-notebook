\documentclass[11pt]{article}
\usepackage{geometry}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{hyperref}
\usepackage{sectsty}
\usepackage{cancel}
\usepackage{float}
\usepackage{placeins} 
\usepackage{enumitem}
\sectionfont{\large}
\subsectionfont{\normalsize}
\setlength{\parindent}{0cm}
%\setlength{\parskip}{10pt}
\geometry{top=3cm,bottom=3cm,left=3cm,right=3cm}
\setlist{nosep}

\title{How often should you fill up on gas?}
\author{Jim Tang}
\begin{document}
  \maketitle

Over the past two weeks, I have observed an enormous increase in gas prices. Unfortunately, having not filled up on gas in awhile, I missed it when the prices bottomed out. Perhaps, if I had filled up on gas more often, I may have been able to get it when it was at its lowest. This inspired me to ask the question: in general, is it better to fill up more or less frequently, in smaller or bigger chunks?

\section*{Calculation}
\label{sec:calculation}

Gas prices are known to fluctuate back-and-forth. Mathematically, we can model this with a sinusoidal function. (Recall that any oscillatory signal can be expressed us a sum of sinusoids, so this is a good starting point.) Let $G(t)$ be the gas price as a function of time. With this model,
\begin{equation}
G(t) = G_0 + G_a \sin \left( \frac{2 \pi t}{f}\right) \label{eq:gas_prices},
\end{equation}

where $G_0$ is the average gas price, $G_a$ is the maximum oscillation from the average, and $f$ is the period of oscillation. The values of $G_a / G_0$ and $f$ determine the volatility of prices.

\par Let's say we fill up on gas at constant intervals of time $\tau$, and we do this for a total time $T$, such that during the total time we fill up $N$ times, where
 $$N = \frac{T}{\tau}.$$ 

Every time, we want to fill up our vehicle until it is full, which will require $b \tau$ amount of gas, where $b$ is some proportionality constant with dimensions of [amount of gas] / [time]. The cost of filling up gas the $k$th time $C_k$ is the amount of gas multiplied by the cost of gas at time $t = k \tau$, or
\begin{equation}
C_k = b\tau \, G(t = k \tau) = b\tau \left( G_0 + G_a \sin \left( \frac{2 \pi k \tau}{f}\right) \right).
\end{equation}

The total cost of gas through time $T$, which we will denote as $C$, is
\begin{align}
C = \sum_{k=1}^{N}{C_k} &= \sum_{k=1}^{N}{ b\tau \left( G_0 + G_a \sin \left( \frac{2 \pi k \tau}{f}\right) \right)} \nonumber \\ 
 &= \underbrace{\sum_{k=1}^{N}{ b\tau G_0}}_{=Nb \tau G_0} + \: b \tau G_a \sum_{k=1}^{N} \sin \left( \frac{2 \pi k \tau}{f}\right). \label{eq:sum_C_k}
\end{align}

Define 
$$
C_0 \equiv Nb\tau G_0 = TbG_0
$$

 as the base cost, the cost of gas if you hit the average cost every time you filled up gas. Moving all terms without $\tau$ to the LHS yields
\begin{equation}
\frac{C - C_0}{b G_a} = \tau \sum_{k=1}^{N}{\sin \left( \frac{2 \pi k \tau}{f}\right)} \label{eq:result_dimensional}.
\end{equation}

Nondimensionalizing the equation, we define a dimensionless time $q$
$$
q \equiv \frac{\tau}{f}.
$$ 

In terms of $q$, we can rewrite \eqref{eq:result_dimensional} as
\begin{equation}
\frac{C - C_0}{b G_a f} = q \sum_{k=1}^{N}{\sin \left( 2 \pi k q\right)}. \label{eq:result_dimensionless}
\end{equation}

For simplicity's sake, we will hereafter write the LHS as $L \equiv (C - C_0) / b G_a f$. \\

\par
Recall now that we defined $N$ in terms of $\tau$ (and by extension, $q$). So we are not yet done. We have to evaluate the sum to extract $N$, which, after an involved calculation \footnote{The calculation in all its glory is dealt with in \hyperref[subsec:sine_sum]{Appendix A}.}, results in
\begin{equation}
L = q \: \frac{\sin(N\pi q) \sin((N+1)\pi q)}{\sin(\pi q)}.
\end{equation}

Substituting 
$$
N = \frac{T}{\tau} = \frac{T}{fq},
$$

we get
\begin{equation}
L = q \: \frac{\sin\left(\frac{T \pi}{f}\right) \sin\left(\frac{T \pi}{f} + \pi q\right)}{\sin(\pi q)}. \label{eq:result_final1}
\end{equation}

To simplify \eqref{eq:result_final1}, define a new dimensionless time $p$ as 
$$
p \equiv \frac{T}{f}.
$$ 

Then, we get our final result,
\begin{equation}
\boxed{L = \frac{C - C_0}{b G_a f} = q \: \frac{\sin(\pi p) \sin(\pi (p+q))}{\sin(\pi q)}}. \label{eq:result_final2}
\end{equation}

\section*{Interpretation}
\label{sec:interpetation}
$L$ is a dimensionless measure of how much we actually pay for gas through time $T$, relative to our ``base" cost of paying the average cost each time. We want to see how that varies with our variables, in this case the dimensionless times $p$ and $q$. \\

\par
We recall $p = T / f$, $q = \tau / f$. Think of this as a ``sampling'' problem, where we are sampling a signal (the gas prices) at periodic intervals of $\tau$, for a length of time $T$. The dimensionless forms of those time metrics are just scaled against a reference time which is the period at which the gas prices fluctuate. In summary, $p$ is a measure of for how long you are doing the analysis. $q$ is a measure of how often you want to fill up gas. $q$ is the critical variable to answer the question in the title of this document. \\

\par
The sinusoids in \eqref{eq:result_final2} make it difficult to predict the behavior, compounded by the presence of three of them in products/ratios. In addition, as $-1 \leq \sin u \leq 1$, the ratio in \eqref{eq:result_final2} could range from $-\infty$ to $+\infty$. Instead, to analyze the result, and to answer the question posed in the title, we must look at some limiting cases.

\section*{Limiting Cases}
\label{sec:limiting_cases}

\subsection*{1) $q \rightarrow 0$, $p$ finite}
In this case,
\begin{align}
\sin (\pi q) &\rightarrow \pi q, \nonumber\\
\sin (\pi(p+q))  &\rightarrow \sin(\pi p), \text{ so} \nonumber\\[0.5em]
L = q \: \frac{\sin(\pi p) \sin(\pi (p+q))}{\sin(\pi q)} &\rightarrow \frac{\sin^2(\pi p)}{\pi}. \label{eq:q_to_zero}
\end{align}

A few remarks:
\begin{itemize}
	\item The result in \eqref{eq:q_to_zero} does not depend on $q$.
	\item Instead of the range from $-\infty < L < +\infty$, $ 0 \leq L \leq 1/\pi$. \\
\end{itemize} 

\par 
Although sensibly unlikely since we cannot fill up gas every moment of our lives, this result provides a hunch that the range of possible losses decreases as ``sampling" rate increases. Just as importantly, it provides a sanity-check for our result in \eqref{eq:result_final2}. \textit{Mathematically} speaking, when $q \rightarrow 0$, our discrete sum that we started setting up in \eqref{eq:sum_C_k} (finite, discrete sampling) approaches an \textit{integral} (continuous sampling). If we replace the sum in \eqref{eq:result_dimensionless} with an integral, the results should match this limiting case, which will affirm the validity of \eqref{eq:result_final2}. Spoiler alert: it indeed does.\footnote{See \hyperref[subsec:sum_to_int]{Appendix B} for the calculation.}


\subsection*{2) $p \gg q$, $q$ finite and nonzero}

 In this case,
\begin{align}
\sin (\pi(p+q))  &\rightarrow \sin(\pi p), \text{ so} \nonumber\\[0.5em]
L = q \: \frac{\sin(\pi p) \sin(\pi (p+q))}{\sin(\pi q)} &\rightarrow \frac{q}{\sin(\pi q)}\sin^2(\pi p). \label{eq:p_to_infty}
\end{align}

This is the most sensible approximation, as it says our sampling time is much longer than the interval of sampling. Which makes sense, if we consider our titular question over a long period of time. Indeed, this may be the only question that matters -- what is our \textit{long-term} strategy? The good news is that the math simplifies in this limiting case. \\

\par
First off, $p$ and $q$ are separable, that is, $L = f(p)g(q)$. Thus, we can set aside the $p$ dependence. It is our understanding at this point that the $\sin^2(\pi p)$ term simply scales $L$ relative to $q$ without changing the fundamental dependence. \\

To begin illustrating my subsequent point, I'm going to now scale $L$ by $\pi$ to define
\begin{equation}
L' \equiv \pi L = f(p) \frac{\pi q}{\sin (\pi q)}.
\end{equation}

Again, as we did before with $\sin^2(\pi p)$, we have just scaled $L$ by a constant relative to $q$, which is 100\% valid. Note that I have replaced the $\sin^2$ term by $f(p)$ to make my earlier point clearer as well. And then to complete the syntactic sugaring, we might as well define $q'$ as $\pi q$:
\begin{equation}
L' = f(p) \frac{q'}{\sin q'}.
\end{equation}

Consider the interval $0 < q < 1$, or $0 < q' < \pi$. These are the most common cases, as our sampling period (how often we fill up our gas) $\tau$ is almost always smaller than the period at which the signal (gas prices) fluctuate $f$. (Recall that $q = \tau / f$.) In this interval, we can see that $q'$ will increase faster than $\sin q'$, the latter of which reaches a max at $q' =\pi/2$ and then drops back to zero at $q' = \pi$. Hence the ratio $q'/\sin q'$ is increasing in that interval. So does that mean it's cheaper to fill gas more frequently? Hold up, not yet...

\section*{Phase Shifts}
\label{sec:phase_shifts}

\section*{Appendix}

\subsection*{A. Finite sum of sines}
\label{subsec:sine_sum}

\renewcommand{\theequation}{A.\arabic{equation}}
\begin{equation}
y = mx+b
\end{equation}

\subsection*{B. Sum of sines to integral}
\label{subsec:sum_to_int}

\renewcommand{\theequation}{B.\arabic{equation}}
\begin{equation}
y = mx+b
\end{equation}

\end{document}